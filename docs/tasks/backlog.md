---
category: backlog
status: in_progress
updated: "2025-10-18"
---

# 残課題バックログ

<!-- markdownlint-disable MD013 MD033 -->

| 状態 | ID (ユニーク) | 要約 | 対象領域 | 完了条件 | 備考 | 先行着手タスク |
|:----:|:-------------|:-----|:---------|:---------|:-----|:----------------|
| [ ] | OPS-B01 | Permit/ジッタ/バッチ閾値の運用チューニング | `config/settings.example.json` 系列<br>`src/llm_generic_bot/core/scheduler.py`<br>`src/llm_generic_bot/core/arbiter.py` | テストを先に追加し、Permit/ジッタ/バッチ閾値を調整しても `pytest tests/integration/test_runtime_multicontent_failures.py -q` がグリーンであること、および遅延・Permit 通過率が期待値内に収束するメトリクス検証を `tests/infra/` 配下に追加する。 | ロードマップ「残課題」から OPS-B01 に明記。具体的な閾値とモニタリング条件を決定し、設定ファイルに反映する。 | [OPS-08] ジッタ境界テスト済み。 |
| [ ] | OPS-B02 | Permit 失敗時の再評価フロー整備 | `src/llm_generic_bot/core/orchestrator.py`<br>`src/llm_generic_bot/core/orchestrator/processor.py`<br>`src/llm_generic_bot/core/orchestrator_metrics.py` (メトリクス境界更新時の参照先)<br>`src/llm_generic_bot/core/arbiter.py`<br>`tests/integration/` | Permit 拒否後の再評価タイミングをテストで固定し、再評価時にメトリクス/ログへ再試行理由を記録する。`pytest tests/integration/test_runtime_multicontent_failures.py -k permit -q` を新テストと併せてグリーン化する。 | PermitGate のレート制御と重複スキップの両立を確認するため、再評価待ちキューや通知ダッシュボード更新も含めて検証する。 | [OPS-10] Permit 拒否メトリクス取得済み。 |
| [ ] | OPS-B03 | Permit クォータ多段構成とバッチ再送ガード | `src/llm_generic_bot/core/arbiter.py`<br>`src/llm_generic_bot/core/queue.py`<br>`tests/core/` | 多段クォータを導入するテストを先に追加し、再送ガードが二重送信を防ぎつつ `pytest tests/core/test_quota_gate.py -q` を拡張テストと共にグリーン化する。 | スケジューラ併合と連携し、閾値超過時のバッチ破棄・遅延再送の境界条件を明示する。 | Sprint1 [SND-02] 残課題を引継ぎ。 |
| [ ] | OPS-B04 | `tests/infra/test_metrics_reporting.py` の段階的廃止 | `tests/infra/metrics/`<br>`docs/roadmap.md`<br>`docs/tasks/backlog.md` | 1. `tests/infra/metrics/*` への参照整理が完了し、旧 `tests/infra/test_metrics_reporting.py` への依存が残存しないことをリポジトリ全体で確認する。<br>2. CI (`pytest`, `mypy`, `ruff`) をグリーン化し、`tests/infra/metrics/` 経由のレポート統合が回帰しないことを保証する。<br>3. バックログおよび関連ドキュメントから旧パスの言及を更新し、移行完了手順を共有する。 | metrics レポート統合の移行完了までは旧テストファイルを削除しない。 | 2025-10-18: 本行追加。 |
| [ ] | OPS-B05 | `tests/infra/test_metrics_reporting.py` 撤去前チェック | `tests/infra/metrics/`<br>`tests/infra/test_metrics_reporting.py`<br>`docs/` 全般 | 1. `tests/infra/metrics/*` の参照状況を確認し、旧テストファイルへの残存参照がないことを `rg` などで証明する。<br>2. `pytest`, `mypy`, `ruff` を通過させ、メトリクス報告経路が `tests/infra/metrics/*` のみで成立することを確認する。<br>3. バックログ・ロードマップ・関連ガイドから旧テストファイルの言及を更新し、撤去手順完了を文書化する。 | OPS-B04 の作業完了後に削除フラグを立て、段階的撤去へ移行する。 | OPS-B04 |
| [ ] | OPS-B07 | `tests/infra/test_metrics_reporting.py` 本削除 | `tests/infra/test_metrics_reporting.py`<br>`tests/infra/metrics/`<br>`docs/` 全般 | 1. `tests/infra/test_metrics_reporting.py` を削除し、Git 履歴でも撤去完了とする。<br>2. `rg` などで旧ファイル名・パスの残存参照がないことを最終確認し、結果を記録する。<br>3. CI (`pytest`, `mypy`, `ruff`) を全てグリーン化し、メトリクス報告が回帰していないことを証明する。<br>4. バックログと関連ドキュメントを更新し、撤去完了と移行手順の最終版を共有する。 | 2025-10-18: 本行更新（最終更新日同期）。 | OPS-B05 |
| [ ] | OPS-B06 | `core/orchestrator/__init__.py` レガシーシム撤去 | `src/llm_generic_bot/core/orchestrator/__init__.py`<br>`tests/core/orchestrator*`<br>`tests/integration/*` | 1. 既存の直 import を新パスへ全て置換し、再輸出シムを廃止する。<br>2. `tests/core/orchestrator*` と `tests/integration/*` の参照を新パスへ更新し、必要なテストを先に追加して挙動を固定する。<br>3. CI (`pytest`, `mypy`, `ruff`) をグリーン化し、撤去後の回帰がないことを確認する。<br>4. バックログおよび関連ドキュメントへ移行完了手順と更新内容を反映する。 | 段階的削除と互換維持を優先し、削除前に影響範囲のテストを拡充する。 | OPS-B02 |
| [ ] | UX-B01 | Engagement 指標の長期トレンド分析と調整方針 | `src/llm_generic_bot/features/weather.py`<br>`src/llm_generic_bot/core/orchestrator.py`<br>`src/llm_generic_bot/core/orchestrator/processor.py`<br>`src/llm_generic_bot/core/orchestrator_metrics.py` (メトリクス境界更新時の参照先)<br>`tests/features/` | Engagement ログを一定期間蓄積するテストダブルを用意し、Permit クォータ変動時の通知頻度を調整するロジックを `pytest tests/features/test_weather_engagement.py -q` の新ケースで固定する。 | Sprint2 「残課題」から移管。トレンドに応じた通知頻度調整と PermitGate の協調方針を定義する。 | [UX-01] Engagement 反映ロジック実装済み。 |
| [x] | DOC-B08 | runtime_multicontent の DM ダイジェスト節を現行実装へ同期 | `docs/roadmap.md`<br>`docs/tasks/backlog.md` | 1. `docs/roadmap.md` で DM ダイジェスト統合テストの説明を更新し、`tests/integration/runtime_multicontent/test_pipeline_dm_digest.py::test_dm_digest_job_registers_without_enqueue` と `tests/integration/runtime_multicontent/test_dm_digest.py::test_dm_digest_job_sends_without_scheduler_queue` が sender 直接送信と dispatch 非発火を担保していることを明文化する。<br>2. 更新内容をバックログへ反映するため、本ファイルの Frontmatter `updated` 日付と DM ダイジェスト関連タスクの備考を調整し、差分確認後に `markdownlint docs/roadmap.md`・`markdownlint docs/tasks/backlog.md` を実行する。<br>3. `git diff` で意図しない変更が混入していないことを確認する。 | 2025-10-18: ドキュメント更新・整形確認を完了し、バックログを同期済み。ロードマップ側でテスト説明を同期済み。 | OPS-B07 |
| [x] | DOC-B09 | 週次サマリ節のテンプレート差分説明を補完 | `docs/roadmap.md` | 1. `tests/integration/runtime_weekly_report/test_templates.py`・`test_scheduler.py`・`test_fallbacks.py` で保証しているテンプレート整形/曜日スケジュール/自己成功率除外の内容を再確認し、`docs/roadmap.md` の該当節へ不足している検証観点（テンプレート差分ハイライトや fallback 経路）を追記する。<br>2. `markdownlint docs/roadmap.md` を実行し、書式崩れがないことを確認する。<br>3. `git diff docs/roadmap.md` で意図した差分のみになっていることを確認する。 | 2025-10-18: 完了・同期済み。 | OPS-B02 |
| [x] | DOC-B10 | デデュープ無効化テストと cooldown.jobs 検証のロードマップ反映 | `docs/roadmap.md` | 1. ロードマップにデデュープ無効化テストの検証観点を追記する。<br>2. 同じく cooldown.jobs 検証内容を整理し、ロードマップへ反映する。<br>3. 上記 2 テスト（デデュープ無効化テスト、cooldown.jobs 検証）を完了条件として明記し、`markdownlint docs/roadmap.md` を実行して整形崩れがないことを確認する。 | 2025-10-17: 本行追加。<br>2025-10-18: ロードマップへデデュープ無効化テストと cooldown.jobs 検証内容を反映し、整形確認まで完了。<br>2025-10-18: バックログ完了状態を確認し備考を整備。 | OPS-B07 |
| [x] | DOC-B11 | Weather キャッシュローテーション/週次サマリ設定テスト反映 | `docs/roadmap.md` | Weather キャッシュローテーションと週次サマリ設定テストの反映が完了し、ロードマップへ検証観点が整備されている。 | 関連テスト: `tests/features/test_weather_cache_rotation.py`、`tests/features/test_report.py`、`tests/config/test_settings_example_report.py`。検証: `pytest tests/features/test_weather_cache_rotation.py tests/features/test_report.py tests/config/test_settings_example_report.py -q` を実行して反映内容を確認する。<br>完了日: 2025-10-18。`docs/roadmap.md` 反映済み。 | OPS-B07 |
| [x] | DOC-B12 | 構造化ログ節のロードマップ同期 | `docs/roadmap.md` | `docs/roadmap.md` の構造化ログ節を `tests/core/structured_logging/test_*.py` 群の最新仕様へ同期し、成功/失敗/Permit/重複/メトリクス各モジュールの検証観点を明文化する。 | 関連テスト: `tests/core/structured_logging/test_success.py`、`test_failure.py`、`test_permit.py`、`test_duplicate.py`、`test_metrics.py`。テスト先行実行: `pytest tests/core/structured_logging -q` を完了条件に含める。完了日: 2025-10-18。`tests/core/structured_logging/test_*.py` 群と同期済みでロードマップ側へ反映済み。 | OPS-B07 |
| [ ] | DOC-B13 | DOC-B14 参照修正 | `docs/roadmap.md` | `docs/roadmap.md` の該当節を確認し、`tests/adapters/test_retry_policy.py::test_max_attempts` の検証手順が最新化されていることを確かめる。完了条件として `pytest tests/adapters/test_retry_policy.py::test_max_attempts -q` を実行する。 | SND-01 節の再確認を目的としたフォローアップ。完了条件に検証手順を明記。 | DOC-B14 |
| [x] | DOC-B14 | SND-01 RetryPolicy の test_max_attempts 同期 | `docs/roadmap.md` | ロードマップの SND-01 節を `tests/adapters/test_retry_policy.py::test_max_attempts` の仕様に揃え、検証手順として `pytest tests/adapters/test_retry_policy.py::test_max_attempts -q` 実行を明記する。 | Sprint1 SND-01 の記述が retry 最大試行検証へ追随していないため、`test_max_attempts` 観点で同期する更新。完了日: 2025-10-18。`docs/roadmap.md` 反映済み。<br>2025-10-18: DOC-B12/DOC-B13 の重複を DOC-B14 へ統合済み。 | SND-01 |

## 進行手順

1. 各残課題について、テストケースを先に作成し現状挙動を固定する。
2. テスト結果をもとに設定値やフローを調整し、`pytest`, `mypy src`, `ruff check .` を順に実行して回帰を防ぐ。
3. 設定変更は `config/settings.example.json` への反映とリリースノート下書きを忘れず、完了後は当表のチェックボックスを更新する。
